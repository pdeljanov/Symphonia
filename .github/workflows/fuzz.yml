name: Fuzzing

# Extended fuzz support is currently only available on the `dev-0.6` branch.
# TODO(#330): once 0.6 is folded back into `master`, update targets here.
on:
  push:
    branches: [ dev-0.6 ]
  pull_request:
    branches: [ dev-0.6 ]

env:
  CARGO_TERM_COLOR: always

jobs:
  smoke-test:
    name: Smoke Test (10 seconds)
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Install Rust
      uses: dtolnay/rust-toolchain@nightly

    - name: Install cargo-fuzz
      run: cargo install cargo-fuzz

    - name: Run Fuzzers (Smoke Test)
      run: |
        cd symphonia/fuzz
        # Ensure the script is executable
        chmod +x run_all.sh
        # Run each fuzzer for 10 seconds to ensure they build and run without immediate crashes
        ./run_all.sh 10
